<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="计算巢是阿里云开放给企业应用服务商的服务管理平台。服务商能够在计算巢上发布私有化部署服务，为其客户提供云上软件一键部署的能力；同时也支持全托管模式的服务，赋能服务商托管其客户资源。">
  <title>LAMMPS Ehpc计算巢快速部署 - Aliyun 计算巢 x Demo</title>

  <link rel="shortcut icon" href="img/favicon.ico">

  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
  <link rel="stylesheet" href="css/theme.css">
  

  

  
  

  
    <script src="search/main.js"></script>
  

  

  <script src="js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<body>
  <div class="container">
    <div class="nav">
      <div class="nav-inner">
        <div class="logo">
          <img src="./img/logo-2x.png">
        </div>
        <div class="nav-list">
          <ul>
          
              <li><a href="#lammps-ehpc">LAMMPS Ehpc计算巢快速部署</a></li>
              
                  <li><a href="#_1">概述</a></li>
                  
              
                  <li><a href="#_2">前提条件</a></li>
                  
              
                  <li><a href="#_3">计费说明</a></li>
                  
              
                  <li><a href="#_4">部署架构</a></li>
                  
              
                  <li><a href="#_5">参数说明</a></li>
                  
              
                  <li><a href="#_6">部署流程</a></li>
                  
              
                  <li><a href="#_7">使用流程</a></li>
                  
                      <li class="li-h3"><a href="#_8">步骤一：通过控制台连接集群</a></li>
                  
                      <li class="li-h3"><a href="#_9">步骤二：提交作业</a></li>
                  
                      <li class="li-h3"><a href="#_10">步骤三：查看作业结果</a></li>
                  
              
          
          </ul>
        </div>
      </div>
    </div>
    <div class="content theme-github">
      
      <div class="content-inner">        
        
        <h1 id="lammps-ehpc">LAMMPS Ehpc计算巢快速部署</h1>
<blockquote>
<p><strong>免责声明：</strong>本服务由第三方提供，我们尽力确保其安全性、准确性和可靠性，但无法保证其完全免于故障、中断、错误或攻击。因此，本公司在此声明：对于本服务的内容、准确性、完整性、可靠性、适用性以及及时性不作任何陈述、保证或承诺，不对您使用本服务所产生的任何直接或间接的损失或损害承担任何责任；对于您通过本服务访问的第三方网站、应用程序、产品和服务，不对其内容、准确性、完整性、可靠性、适用性以及及时性承担任何责任，您应自行承担使用后果产生的风险和责任；对于因您使用本服务而产生的任何损失、损害，包括但不限于直接损失、间接损失、利润损失、商誉损失、数据损失或其他经济损失，不承担任何责任，即使本公司事先已被告知可能存在此类损失或损害的可能性；我们保留不时修改本声明的权利，因此请您在使用本服务前定期检查本声明。如果您对本声明或本服务存在任何问题或疑问，请联系我们。</p>
</blockquote>
<h2 id="_1">概述</h2>
<p>LAMMPS（Large-scale Atomic/Molecular Massively Parallel Simulator）是一款经典分子动力学软件。 LAMMPS包含的势函数可用于固体材料（金属、半导体）、软物质（生物大分子，聚合物）、粗粒化或介观尺度模型体系。</p>
<h2 id="_2">前提条件</h2>
<p>部署LAMMPS社区版服务实例，需要对部分阿里云资源进行访问和创建操作。因此您的账号需要包含如下资源的权限。
  <strong>说明</strong>：当您的账号是RAM账号时，才需要添加此权限。</p>
<table>
<thead>
<tr>
<th>权限策略名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>AliyunECSFullAccess</td>
<td>管理云服务器服务（ECS）的权限</td>
</tr>
<tr>
<td>AliyunVPCFullAccess</td>
<td>管理专有网络（VPC）的权限</td>
</tr>
<tr>
<td>AliyunROSFullAccess</td>
<td>管理资源编排服务（ROS）的权限</td>
</tr>
<tr>
<td>AliyunEHPCFullAccess</td>
<td>管理弹性高性能计算（EHPC）的权限</td>
</tr>
<tr>
<td>AliyunNASFullAccess</td>
<td>管理文件存储（NAS）的权限</td>
</tr>
<tr>
<td>AliyunComputeNestUserFullAccess</td>
<td>管理计算巢服务（ComputeNest）的用户侧权限</td>
</tr>
</tbody>
</table>
<h2 id="_3">计费说明</h2>
<p>LAMMPS社区版在计算巢部署的费用主要涉及：</p>
<ul>
<li>弹性高性能计算集群（EHPC）费用</li>
<li>文件系统（NAS）费用</li>
<li>流量带宽费用</li>
</ul>
<h2 id="_4">部署架构</h2>
<p><img src="1.png" width="1500" height="700" align="bottom"/></p>
<ul>
<li>部署由一个ehpc集群组成，ehpc集群中包括manager节点、schedule节点和compute节点</li>
<li>服务使用nas-cpfs构建高性能共享文件系统</li>
</ul>
<h2 id="_5">参数说明</h2>
<table>
<thead>
<tr>
<th>参数组</th>
<th>参数项</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务实例</td>
<td>服务实例名称</td>
<td>长度不超过64个字符，必须以英文字母开头，可包含数字、英文字母、短划线（-）和下划线（_）</td>
</tr>
<tr>
<td></td>
<td>地域</td>
<td>服务实例部署的地域</td>
</tr>
<tr>
<td></td>
<td>付费类型</td>
<td>资源的计费类型：按量付费和包年包月</td>
</tr>
<tr>
<td>EHPC集群配置</td>
<td>集群登录密码</td>
<td>长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&amp;*-+=&#124;{}[]:;'&lt;&gt;,.?/ 中的特殊符号）</td>
</tr>
<tr>
<td></td>
<td>Ehpc部署模式</td>
<td>Tiny，Simple，Standard</td>
</tr>
<tr>
<td></td>
<td>计算节点实例类型</td>
<td>可用区下可以使用的计算节点规格</td>
</tr>
<tr>
<td></td>
<td>计算节点数量</td>
<td>计算节点数量, 可选值: 1-99</td>
</tr>
<tr>
<td></td>
<td>登录节点实例类型</td>
<td>可用区下可以使用的登录节点规格</td>
</tr>
<tr>
<td></td>
<td>管控节点数量</td>
<td>管控节点数量, 可选值: 1,2,4</td>
</tr>
<tr>
<td>EHPC集群用户配置</td>
<td>用户密码</td>
<td>长度8-30，必须包含三项（大写字母、小写字母、数字、()~!@#$%^&amp;*-_+=\</td>
</tr>
<tr>
<td></td>
<td>用户名称</td>
<td>登录集群所用的用户名，默认为lammps</td>
</tr>
<tr>
<td>网络配置</td>
<td>可用区</td>
<td>ECS实例所在可用区</td>
</tr>
<tr>
<td></td>
<td>VPC ID</td>
<td>资源所在VPC</td>
</tr>
<tr>
<td></td>
<td>交换机ID</td>
<td>资源所在交换机</td>
</tr>
</tbody>
</table>
<h2 id="_6">部署流程</h2>
<ol>
<li>
<p>访问计算巢LAMMPS社区版<a href="https://computenest.console.aliyun.com/user/cn-hangzhou/serviceInstanceCreate?&amp;ServiceId=service-199f5aeaf0f142918076">部署链接</a>
，按提示填写部署参数：
    <img alt="image.png" src="2.png" /></p>
</li>
<li>
<p>参数填写完成后可以看到对应询价明细，确认参数后点击<strong>下一步：确认订单</strong>。
   <img alt="image.png" src="3.png" /></p>
</li>
<li>
<p>确认订单完成后同意服务协议并点击<strong>立即创建</strong>
   进入部署阶段。
    <img alt="image.png" src="4.png" /></p>
</li>
</ol>
<h2 id="_7">使用流程</h2>
<h3 id="_8">步骤一：通过控制台连接集群</h3>
<ol>
<li>登录<a href="https://ehpc.console.aliyun.com">弹性高性能计算控制台</a>。</li>
<li>在顶部菜单栏左上角处，选择地域。</li>
<li>在左侧导航栏，单击<strong>集群</strong>。</li>
<li>
<p>在<strong>集群</strong>页面，找到在计算巢部署好的目标集群，单击<strong>远程连接</strong>。
    <img src="5.png" height="700" align="bottom"/></p>
</li>
<li>
<p>在<strong>远程连接</strong>页面，输入集群用户名、登录密码和端口，单击<strong>ssh连接</strong>。</p>
</li>
</ol>
<h3 id="_9"><strong>步骤二：提交作业</strong></h3>
<p>本文介绍如何使用E-HPC集群运行LAMMPS开源仿真软件，以3d Lennard-Jones melt模型进行工业仿真，并通过可视化的方式查看仿真结果。</p>
<ol>
<li>执行以下命令创建算例文件，算例文件命名为lj.in。</li>
</ol>
<pre><code>vim lj.in
</code></pre>
<p>作业脚本内容示例如下：</p>
<pre><code># 3d Lennard-Jones melt
variable        x index 1
variable        y index 1
variable        z index 1

variable        xx equal 20*$x
variable        yy equal 20*$y
variable        zz equal 20*$z

units           lj
atom_style      atomic

lattice         fcc 0.8442
region          box block 0 ${xx} 0 ${yy} 0 ${zz}
create_box      1 box
create_atoms    1 box
mass            1 1.0

velocity        all create 1.44 87287 loop geom

pair_style      lj/cut 2.5
pair_coeff      1 1 1.0 1.0 2.5

neighbor        0.3 bin
neigh_modify    delay 0 every 20 check no

fix             1 all nve
dump 1 all xyz 100 sample.xyz
run             10000
</code></pre>
<p>2.执行以下命令创建作业脚本文件，脚本文件命名为lammps.pbs。</p>
<pre><code>vim lammps.pbs
</code></pre>
<blockquote>
<p>以下示例使用1个计算节点的32 vCPU，使用32个MPI任务进行高性能计算。请根据实际计算节点规格配置vCPU数，算力要求vCPU≥32。</p>
</blockquote>
<p>作业脚本内容示例如下：</p>
<pre><code>#!/bin/sh
#PBS -l select=1:ncpus=32:mpiprocs=32
#PBS -j oe

export MODULEPATH=/opt/ehpcmodulefiles/   #module命令依赖的环境变量
module load lammps-openmpi/31Mar17
module load openmpi/1.10.7

echo &quot;run at the beginning&quot;
mpirun lmp -in ./lj.in                    #请根据实际修改lj.in文件的路径
</code></pre>
<p>3.执行以下命令提交作业。</p>
<pre><code>qsub lammps.pbs
</code></pre>
<p>预期返回如下，表示生成的作业ID为0.scheduler。</p>
<pre><code>0.scheduler
</code></pre>
<h3 id="_10"><strong>步骤三：查看作业结果</strong></h3>
<ol>
<li>查看作业运行情况。</li>
</ol>
<pre><code>cat lammps.pbs.o0
</code></pre>
<blockquote>
<p>如果您不指定作业标准输出路径，则默认按照调度器行为生成输出文件。默认作业结果文件输出/home/&lt;用户名&gt;/目录下，本示例中的作业结果文件为/home/testuser/lammps.pbs.o0。</p>
</blockquote>
<p>预期返回如下:</p>
<pre><code>......
Per MPI rank memory allocation (min/avg/max) = 3.777 | 3.801 | 3.818 Mbytes
Step Temp E_pair E_mol TotEng Press 
           0         1.44   -6.7733681            0   -4.6134356   -5.0197073 
       10000   0.69814375   -5.6683212            0   -4.6211383   0.75227555
Loop time of 9.81493 on 32 procs for 10000 steps with 32000 atoms

Performance: 440145.641 tau/day, 1018.856 timesteps/s
97.0% CPU use with 32 MPI tasks x no OpenMP threads

MPI task timing breakdown:
|Section |  min time  |  avg time  |  max time  |%varavg| %total
|---------------------------------------------------------------
|Pair    | 6.0055     | 6.1975     | 6.3645     |   4.0 | 63.14
|Neigh   | 0.90095    | 0.91322    | 0.92938    |   0.9 |  9.30
|Comm    | 2.1457     | 2.3105     | 2.4945     |   6.9 | 23.54
|Output  | 0.16934    | 0.1998     | 0.23357    |   4.3 |  2.04
|Modify  | 0.1259     | 0.13028    | 0.13602    |   0.8 |  1.33
|Other   |            | 0.06364    |            |       |  0.65

Nlocal:    1000 ave 1022 max 986 min
Histogram: 5 3 6 3 4 4 2 2 1 2
Nghost:    2705.62 ave 2733 max 2668 min
Histogram: 1 1 0 3 7 5 4 5 4 2
Neighs:    37505 ave 38906 max 36560 min
Histogram: 7 3 2 4 5 2 3 3 2 1

Total # of neighbors = 1200161
Ave neighs/atom = 37.505
Neighbor list builds = 500
Dangerous builds not checked
Total wall time: 0:00:10
</code></pre>
<ol>
<li>
<p>使用VNC可视化查看作业结果。</p>
<ol>
<li>打开VNC。 控制台操作时系统会自动打开集群安全组 12016 端口。 </li>
<li>在<a href="https://ehpc.console.aliyun.com">弹性高性能计算控制台</a>的左侧导航栏，单击<strong>集群</strong>。 </li>
<li>在<strong>集群</strong>页面，找到目标集群，单击<strong>更多</strong> &gt; <strong>VNC</strong>。</li>
<li>使用VNC远程连接可视化服务。具体操作，请参见<a href="https://help.aliyun.com/zh/e-hpc/user-guide/use-vnc-to-manage-a-visualization-service#section-bf6-eyn-edu">连接可视化服务</a>。</li>
<li>在VNC窗口中，选择<strong>Application&gt;System Tools&gt;Terminal</strong>。</li>
<li>运行<code>/opt/vmd/1.9.3/vmd</code>打开VMD软件。</li>
<li>在VMD Main对话框中，选择<strong>File &gt; New Molecule...</strong>。</li>
<li>单击<strong>Filename</strong>处对应的<strong>Browse...</strong>，选择结果文件sample.xyz。</li>
<li>sample.xyz文件所在路径为/home/{用户名}/sample.xyz。</li>
<li>单击<strong>Load</strong>，可在<strong>VMD 1.9.3 OpenGL Display</strong>窗口查看可视化结果。</li>
</ol>
<p><img src="7.png" height="800" align="bottom"/></p>
</li>
</ol>
        
      </div>

      <div class="copyrights">© 2009-2022 Aliyun.com 版权所有</div>
    </div>
  </div>
  
  <!--
  MkDocs version      : 1.5.3
  Docs Build Date UTC : 2023-11-09 11:51:37.903794+00:00
  -->
</body>
</html>